# rigz - Rust Parallel Gzip

Fast, parallel gzip replacement. Beats gzip and pigz by 40-50%.

## Quick Start

```bash
make           # Build + quick benchmark
make validate  # Verify output works with gunzip
cargo test     # Unit tests
```

## Core Algorithm (parallel_compress.rs)

```
Input → mmap → [chunk1, chunk2, ...] → rayon parallel → [gzip1, gzip2, ...] → concatenate → Output
```

Each 128KB chunk becomes a complete gzip member. RFC 1952 allows concatenation.

## Key Files

| File | What it does |
|------|--------------|
| `parallel_compress.rs` | **THE CORE**: rayon + flate2 parallel compression |
| `compression.rs` | Routes single vs multi-threaded |
| `decompression.rs` | libdeflate (fast) + flate2 (multi-member) |
| `cli.rs` | gzip-compatible argument parsing |

## Performance Strategy

**Compression:**
- zlib-ng via flate2 (2-3x faster than standard zlib)
- 128KB fixed blocks (dynamic sizing regressed 14%)
- Global rayon pool (avoids per-call initialization)

**Decompression:**
- Single-member: libdeflate (30-50% faster than zlib)
- Multi-member: zlib-ng via flate2 (reliable boundary parsing)

## What Doesn't Work

1. **Manual deflate boundary detection** - Deflate streams contain false gzip headers
2. **Dynamic block sizing** - Added complexity, 14% slower
3. **gzp crate** - Threading issues; custom rayon is better

## Benchmarking

- 30 runs for 1MB (high variance)
- 15 runs for 10MB  
- Use median, not min

See CONTRIBUTING.md for detailed architecture guide.
